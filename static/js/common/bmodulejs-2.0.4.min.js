!function(a){var b={};b.info="VERSION: 2.0.4 \n AUTHOR: liuping \n A Controller For Modules";var c={executedList:{}},d={initFnName:"init",destroyFnName:"destroy",autoLoad:!0,autoSrc:!0,scriptSrc:"msrc",afterSrc:"after",handlerName:"me",codePackage:!1,sourceRoot:"",debug:!1,useLog:!0};$BASE={},$BASE.unikey=function(a){for(var b="number"==typeof a?a:16,c="";c.length<b;c+=Math.random().toString(36).substr(2));return c.substr(0,b)},$BASE.trim=function(a){if("string"!=(typeof a).toLowerCase())return a;for(var b=a.length,c=/\s/,d=0;b>d&&c.test(a.charAt(d));d++);if(d>=b)return"";for(var e=b-1;e>=0;e--)if(!c.test(a.charAt(e))){e++;break}return a.slice(d,e)},$BASE.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},$BASE.isWhat=function(a,b){var c=typeof a;if("undefined"==c)return/^undefined$/i.test(b);var d=new RegExp(b,"gi");try{var e=a.constructor.toString();return d.test(e)}catch(f){return/^object$/i.test(c)&&/^null$/i.test(b)}},$BASE.parseObj=function(a,b,c){var d={};b=$BASE.isWhat(b,"object")?b:{};for(var e in a)if(d[e]=a[e],e in b){var f=b[e],g=parseFloat(f);c&&!isNaN(g)&&(f=g),d[e]=f}return d},$BASE.isNode=function(a,b){return a&&"number"==(typeof a.nodeType).toLowerCase()?b?a.nodeType==parseInt(b):!0:!1},$BASE.objLength=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},$BASE.getTime=function(a,b){var a=a||"/",c=new Date,d=parseInt(b);if(!isNaN(d)){var e=864e5*d;c=new Date(+c+e)}var f=c.getMonth()+1,g=c.getDate(),h=c.getMinutes(),i=c.getHours(),j=c.getSeconds(),k=c.getFullYear();f=f.toString().length<2?"0"+f:f,g=g.toString().length<2?"0"+g:g,i=i.toString().length<2?"0"+i:i,h=h.toString().length<2?"0"+h:h,j=j.toString().length<2?"0"+j:j;var l=[];l.push(k),l.push(f),l.push(g);var m=[];return m.push(i),m.push(h),m.push(j),l.join(a)+" "+m.join(":")},$BASE.extend=function(a,b){var c=function(){};return c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a},$BASE.newClass=function(a,b){var c=b||function(){};if("object"==typeof a)for(var d in a)a.hasOwnProperty(d)&&(c.prototype[d]=a[d]);return c},$BASE.indexOf=function(a,b){return $BASE.isArray(b)?($BASE.indexOf="undefined"!=typeof b.indexOf?function(a,b){return b.indexOf(a)}:function(a,b){for(var c=-1,d=0;d<b.length;d++)if(b[d]===a){c=d;break}return c},$BASE.indexOf(a,b)):!1},$BASE.consoleLog=function(a){console&&console.log&&console.log(a)},$BASE.emptyFn=function(){},$BASE.removeNode=function(a){a.parentNode.removeChild(a)},$BASE.isDefined=function(a,b){a=$BASE.trim(a);var c;if(-1==a.indexOf("."))c=b[a];else{for(var d=a.split("."),e=b,f=0;f<d.length&&(e=e[d[f]],"undefined"!=typeof e);f++);c=e}return!!c};var e=$BASE,f={priorityQueue:{list:[],cbks:{}},historyPri:[],historyQueue:[],busyState:{},globalLock:!1,addQueue:function(a,b,c){var d=e.parseObj({power:0,callBack:function(){}},b||{},!0);-1==e.indexOf(a,f.historyPri)&&-1==e.indexOf(a,f.historyQueue)&&(f.busyState[a]=!0,f.priorityQueue.list.splice(d.power,0,a)),f.priorityQueue.cbks[a]||(f.priorityQueue.cbks[a]=[]),f.priorityQueue.cbks[a].push({fn:d.callBack,custSpec:c}),f.historyPri.push(a)},jsTagCreat:function(a){f.globalLock=!0;for(var b=e.parseObj({isAsyn:!0,isClear:!0},a||{});f.priorityQueue.list.length>0;){var c=f.priorityQueue.list.pop(),g=f.priorityQueue.cbks[c],h=document.createElement("script");h.type="text/javascript",h.defer=b.isAsyn,h.src=d.sourceRoot+c,b.isAsyn&&("onreadystatechange"in h?h.onreadystatechange=function(){var a=h.readyState;if("loaded"==a.toLowerCase()||"complete"==a.toLowerCase()){for(var d=0,i=g.length;i>d;d++)g[d].fn(c,g[d].custSpec);f.busyState[c]=!1,b.isClear&&e.removeNode(h),f.historyQueue.push(c),delete f.priorityQueue.cbks[c]}}:h.onload=function(){for(var a=0,d=g.length;d>a;a++)g[a].fn(c,g[a].custSpec);f.busyState[c]=!1,b.isClear&&e.removeNode(h),f.historyQueue.push(c),delete f.priorityQueue.cbks[c]}),document.body.appendChild(h)}0==f.priorityQueue.list.length&&(f.globalLock=!1)},loader:function(a,b,c){if(e.isArray(a))for(var d=0;d<a.length;d++)f.loader(a[d],b,c);else{var a=e.trim(a),g=e.parseObj({isAsyn:!0,power:0,isClear:!0,callBack:function(){}},b||{},!0);if(-1!=e.indexOf(a,f.historyQueue))return void g.callBack(a,c);f.addQueue(a,g,c),f.globalLock||f.jsTagCreat(g)}}},g=function(){var a={},b={};this.push=function(c,d,f){var g="";if(d.constructor==o)g=d.mName||e.unikey();else{if("string"!=typeof d)throw"MSG pushing error!";g=d}var h="__MSG__"+g,i=f.mName,j={data:c,sender:i,receiver:g},k=b[h]?b[h].length:0;if(!k)return a[h]?a[h].push(j):a[h]=[j],h;for(var l=0;k>l;l++){var m=b[h][l];m&&m(j)}},this.get=function(b){var c="";if(b.constructor==o)c=b.mName;else{if("string"!=typeof b)throw"MSG getting error!";c=b}if(c){var d="__MSG__"+c,e=a[d];return a[d]=[],e&&e.length?e:void 0}},this.addHandler=function(a,c){var d="";if(a.constructor==o)d=a.mName;else{if("string"!=typeof a)throw"MSG adding handler error!";d=a}if(d){var e="__MSG__"+d;b[e]?b[e].push(c):b[e]=[c]}},this.delHandler=function(a,c){var d="";if(a.constructor==o)d=a.mName;else{if("string"!=typeof a)throw"MSG deleting handler error!";d=a}if(d){var e="__MSG__"+d,f=0;if(b[e]&&(f=b[e].length))if(c)for(var g=0;f>g;g++)b[e][g]==c&&b[e].splice(g,0,1);else b[e]=[]}}},h=function(){};h.prototype._set=function(a,b,c){return"string"!=typeof a||"string"!=typeof b?!1:!this.hasOwnProperty(a)||c?(this[a]=b,!0):!1};var i=function(){this._fnstore={}};i.prototype.fire=function(a,b){if(a=e.trim(a))for(var c=this._fnstore[a]||[],d=0,f=c.length;f>d;d++)c[d](b)},i.prototype.add=function(a,b){a=e.trim(a),a&&"function"==typeof b&&(this._fnstore[a]||(this._fnstore[a]=[]),this._fnstore[a].push(b))},i.prototype.remove=function(a,b){if(a=e.trim(a),a&&!this._fnstore[a])if(b){var c=e.indexOf(b,this._fnstore[a]);-1!=c&&this._fnstore.splice(c,1)}else delete this._fnstore[a]};var j=(new i,{}),k={},l={},m=function(a){for(var b=0,c=a.length;c>b;b++)if("ok"!=j[a[b].mName])return!1;return!0},n=function(a){if("lock"!=j[a.mName]){j[a.mName]="lock";var d=a.rLink,e=function(a){for(;k[a.mName]&&k[a.mName].length;){var b=k[a.mName].shift();b&&b()}a.log("Ok for module <"+a.mName+">","Complete")};if(0==d.length||m(d))return j[a.mName]="ok",void e(a);for(var g,h=0,i=d.length;i>h;h++)if(g=d[h],c.executedList[g]){var o=b.getModule(g);k[o.mName]||(k[o.mName]=[]),k[o.mName].push(function(){a.leftLinkNum--,0==a.leftLinkNum&&(j[a.mName]="ok",e(a))}),n(o)}else{if(!p[g]||!p[g].src)throw'Error on "require" about '+a.mName;a.log("Loading <"+a.mName+">'s link file<"+g+">.","Link"),f.loader(p[g].src,{callBack:function(c,d){var f=b.getModule(d),g=function(b){k[b.mName]||(k[b.mName]=[]),k[b.mName].push(function(){a.leftLinkNum--,a.log("Loaded link file <"+b.mName+"> by <"+a.mName+"> [left "+a.leftLinkNum+" file]","Loaded"),a.leftLinkNum<=0&&(a.log("Completely loaded link file <"+b.mName+"> by <"+a.mName+">","AllLoaded"),j[a.mName]="ok",e(a))}),n(b)};f?g(f):(l[d]||(l[d]=[]),l[d].push(function(){var a=b.getModule(d);g(a)}))}},g)}}},o=function(a){var b={};this.skipRecord=function(a,c){a&&(b[a]=!!c)},this.needSkip=function(a){var c=!1;return b.hasOwnProperty(a)&&(c=b[a]),c},this.mName=a,this.rLink=[],this.leftLinkNum=0,this.logList=[],this.interface={},this.__tailState=d.debug||!1,this.mUsable=!0},p={},q={},r=new g;o.prototype.tailLog=function(a){d.useLog&&("undefined"==typeof a&&(a=!0),a&&!this.__tailState&&a&&this.showLog(this.__tailState),this.__tailState=a)},o.prototype.log=function(a,b){if(d.useLog){var c=e.getTime("-"),f="LOG["+(b||"normal")+"]:"+a+" At "+c+"\n";this.__tailState&&(this.__tailState===!0&&e.consoleLog(f),b===this.__tailState&&e.consoleLog(f)),this.logList[this.logList.length]=f}},o.prototype.showLog=function(a){if(!d.useLog)return"";if("string"==typeof a)for(var b="",c=0,f=this.logList.length;f>c;c++){var g=this.logList[c],h=g.indexOf("]"),i=g.indexOf("[");g.slice(i+1,h)==a&&(b+=g)}else var b=this.logList.join("");return e.consoleLog(b),b},o.prototype.tools=e,o.prototype.tools.jsLoader=f.loader,o.prototype.build=function(){if(!this.mUsable)return void this.log('No permission for "building"!',"Error");var a,b={};switch(typeof arguments[0]){case"object":b=arguments[0],a=arguments[1],"string"==typeof arguments[2]&&(arguments[0].hasOwnProperty(arguments[2])?b[arguments[2]]=arguments[0][arguments[2]]:b={});break;case"string":b[arguments[0]]=arguments[1],a=arguments[2];break;default:return void this.log('Illegal param for "building"',"Error")}for(var c in b)if(b.hasOwnProperty(c)){if(this.hasOwnProperty(c)){if(!a){this.log('Repeat define for "'+c+'"',"Error");continue}this.log('Repeat define for "'+c+'"',"Warning")}this[c]="function"==typeof b[c]&&b.constructor!=o?function(){return"process"!=this.__tailState||this.needSkip(c)||this.log("Running:"+(this.mName||"anonymity")+"."+c,"Record"),b[c].apply(this,arguments)}:b[c],this.log('Success define for "'+c+'" in '+this.mName,"Define")}return this},o.prototype.mSend=function(a,b){try{r.push(a,b,this),this.log("Sending data from "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error sending from "+this.mName||"anonymity","Error")}},o.prototype.mMonitor=function(a,b){try{r.addHandler(b||this,a),this.log("Adding monitor in "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error monitor in "+this.mName||"anonymity","Error")}},o.prototype.mUnmonitor=function(a,b){try{r.delHandler(b||this,a),this.log("Deleting monitor in "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error unmonitor in "+this.mName||"anonymity","Error")}},o.prototype.interfaceDefine=function(a,b,c){if(arguments.length<2)return void this.log("Param illegal for Interface defining","Error");if(this.interface.hasOwnProperty(a)){if(!c)return void this.log('Repeat interface defining for "'+a+'"',"Error");this.log('Repeat interface defining for "'+a+'"',"Warning")}"string"==typeof b&&(b=[b]);var d=[];for(var e in b)"string"==typeof b[e]?d.push(b[e]):this.log("Illegal interface methods name for defining!","Error");return this.interface[a]=d,this.log('Success defining for interface "'+a+'"',"Success"),d},o.prototype.interfaceCheck=function(a){var b=[];if("string"==typeof a){if(!this.interface.hasOwnProperty(a))return this.log('The interface name of "'+a+'" is not exist!',"Failure"),!1;b=this.interface[a]}else{if(!e.isWhat(a,"array"))return this.log("Illegal params for interface checking!","Error"),!1;b=a}for(var c=b.length,d=[],f=0;c>f;f++)b[f]in this||d.push(b[f]);return d.length?d:!1},o.prototype.require=function(a,b){"string"!=typeof b&&d.autoSrc&&(b=a.replace(/\./g,"/")+".js"),p[a]?p[a].link.push({state:"off",module:this}):(p[a]={src:b},p[a].link=[{state:"off",module:this}]),-1==e.indexOf(a,this.rLink)&&(this.rLink.push(a),this.leftLinkNum++)},o.prototype.create=function(){var a;arguments.length&&(a=Array.prototype.slice.call(arguments,0)),b.create(this.mName,a)},b.modules={},b.define=function(a){a=e.trim(a);var d=new o(a);if(-1==a.indexOf(".")){if(a in b.modules)throw"Repeat define for "+a;b.modules[a]=d}else{for(var f=a.split("."),g=b.modules,h=0;h<f.length-1;h++)g=g[f[h]]=f[h]in g?g[f[h]]:{};g[f.pop()]=d}if(c.executedList[a]=!0,l[a]){for(var i=l[a],h=0,j=i.length;j>h;h++)i[h]();l[a]=[]}return d},b.create=function(a,f,g){if(a=e.trim(a)){var h=b.getModule(a);if(!h)throw"The module("+a+') you input to "create" is not exist!';var i;switch(h.rLink.length?(i=j[a],"undefined"==typeof i&&(i=j[a]="first")):i="ok",d.codePackage&&(i="ok"),i){case"lock":k[a]||(k[a]=[]),k[a].push(function(){b.create(a,f,g)});break;case"ok":return e.isArray(f)||(f=[f]),q[h.mName]=h[d.handlerName]=h[d.initFnName]&&h[d.initFnName].apply(h,f),c.executedList[a]=!0,g&&g(q[h.mName]),q[h.mName]||!0;case"first":k[a]||(k[a]=[]),k[a].push(function(){b.create(a,f,g)}),n(h);break;default:throw"unknow error on "+a}}},b.destroy=function(a){a&&q[a]&&q[a][d.destroyFnName]&&(q[a][d.destroyFnName](),delete q[a],delete c.executedList[a])},b.options=function(){var a={};switch(arguments.length){case 2:a[arguments[0]]=arguments[1];break;case 1:a=arguments[0];break;default:return!1}return d=e.parseObj(d,a),!0},b.newM=function(a){return new o(a)},b.path=new h,b.jsLoader=f.loader,b.getModule=function(a){var c=e.trim(a);if(!c.length)return!1;var d;if(-1==c.indexOf("."))d=b.modules[c];else{for(var f=c.split("."),g=b.modules,h=0;h<f.length&&(g=g[f[h]],"undefined"!=typeof g);h++);d=g}return d};var s=function(){for(var a,b,c,e=document.getElementsByTagName("script"),g=0,h=e.length;h>g;g++)a=e[g],(b=a.getAttribute(d.scriptSrc))&&(c=a.getAttribute(d.afterSrc))&&f.loader(b,{callBack:function(){f.loader(c)}})},t=function(){s()};t(),a.$M=b}(window);