!function(){if(!window.$M||"object"!=typeof window.$M){var f={},g={},k={};f.info="VERSION: 2.1.0 \n AUTHOR: liuping \n A Controller For Modules";var k={splitSym:"/",initFnName:"init",destroyFnName:"destroy",scriptSrc:"msrc",afterSrc:"after",handlerName:"me",sourceRoot:"",debug:!1,useLog:!0},l=function(){};l.prototype.unikey=function(a){a="number"==typeof a?a:16;for(var b="";b.length<a;b+=Math.random().toString(36).substr(2));return b.substr(0,a)};l.prototype.trim=function(a){if("string"!=(typeof a).toLowerCase())return a;
for(var b=a.length,c=/\s/,d=0;d<b&&c.test(a.charAt(d));d++);if(d>=b)return"";for(b-=1;0<=b;b--)if(!c.test(a.charAt(b))){b++;break}return a.slice(d,b)};l.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};l.prototype.isWhat=function(a,b){var c=typeof a;if("undefined"==c)return/^undefined$/i.test(b);var d=new RegExp(b,"gi");try{return d.test(a.constructor.toString())}catch(e){return/^object$/i.test(c)&&/^null$/i.test(b)}};l.prototype.parseObj=function(a,b,c){var d=
{};b=this.isWhat(b,"object")?b:{};for(var e in a)if(d[e]=a[e],e in b){var f=b[e],g=parseFloat(f);c&&!isNaN(g)&&(f=g);d[e]=f}return d};l.prototype.isNode=function(a,b){return a&&"number"==(typeof a.nodeType).toLowerCase()?b?a.nodeType==parseInt(b):!0:!1};l.prototype.objLength=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};l.prototype.getTime=function(a,b){var c=b&&b.constructor==Date?b:new Date;a=a||"Y-m-d H:i:s";for(var d="",e=c.getFullYear(),f=c.getMonth()+1,g=c.getDate(),h=
c.getHours(),k=c.getMinutes(),l=c.getSeconds(),e=e.toString(),f=f.toString(),g=g.toString(),c=h.toString(),k=k.toString(),l=l.toString(),m=0,v=a.length;m<v;m++){var q=a.charAt(m);switch(q){case "Y":d+=e;break;case "y":d+=e.slice(e.length-2);break;case "m":d+=2>f.length?"0"+f:f;break;case "n":d+=f;break;case "d":d+=2>g.length?"0"+g:g;break;case "j":d+=g;break;case "g":d+=h%12;break;case "G":d+=h;break;case "h":q=(h%12).toString();d+=2>q.length?"0"+q:q;break;case "H":d+=2>c.length?"0"+c:c;break;case "i":d+=
2>k.length?"0"+k:k;break;case "s":d+=2>l.length?"0"+l:l;break;default:d+=q}}return d};l.prototype.extend=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;return a.prototype.constructor=a};l.prototype.newClass=function(a,b){var c=b||function(){};if("object"==typeof a)for(var d in a)a.hasOwnProperty(d)&&(c.prototype[d]=a[d]);return c};l.prototype.indexOf=function(a,b){if(!this.isArray(b))return!1;g.indexOf="undefined"!=typeof b.indexOf?function(a,d){return d.indexOf(a)}:function(a,
d){for(var b=-1,f=0;f<d.length;f++)if(d[f]===a){b=f;break}return b};return g.indexOf(a,b)};l.prototype.consoleLog=function(a){console&&console.log&&console.log(a)};l.prototype.emptyFn=function(){};l.prototype.removeNode=function(a){a.parentNode.removeChild(a)};l.prototype.isDefined=function(a,b){a=this.trim(a);var c;if(-1==a.indexOf(k.splitSym))c=b[a];else{c=a.split(k.splitSym);for(var d=b,e=0;e<c.length&&(d=d[c[e]],"undefined"!=typeof d);e++);c=d}return!!c};l.prototype.nameSpace=function(a,b,c,d){a=
a.split(d||k.splitSym);if(0===a.length)return!1;for(;1<a.length;)d=a.shift(),b=b[d]=b[d]||{};b[a.shift()]=c};l.prototype.nameToItem=function(a,b,c){a=g.trim(a);if(!a.length)return null;var d=null;c=c||k.splitSym;if(-1===a.indexOf(c))d=b[a];else{a=a.split(c);for(c=0;c<a.length;c++){if(!(a[c]in b))return null;b=b[a[c]];if("undefined"===typeof b){c<a.length-1&&(b=null);break}}d=b}return d};g=new l;g.delay=function(a){setTimeout(function(){a&&a()})};var p={};p.c=document.createElement;p.body=document.body;
p.addAttrs=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setAttribute(c,b[c])};var h={lock:!1,tobe:{},tobeorder:[],conf:{},done:[],onload:function(a,b,c){if("onload"in a)h.onload=function(a,c,b){a.onload=function(){c&&c(this,a);h.conf[b]&&h.conf[b].isClear&&g.removeNode(a)}};else if("onreadystatechange"in a)h.onload=function(a,c,b){a.onreadystatechange=function(){var f=this.readyState;if("loaded"==f||"complete"==f)c&&c(this,a),h.conf[b]&&h.conf[b].isClear&&g.removeNode(a)}};else return!1;return h.onload(a,
b,c)},create:function(a,b){var c=document.createElement("script"),d={type:"text/javascript",src:a};h.conf[a]&&h.conf[a].isAsync&&(d.async="true",d.defer="");p.addAttrs(c,d);h.onload(c,b,a);p.body.appendChild(c)},start:function(){for(h.lock=!0;h.tobeorder.length;){var a=h.tobeorder.shift(),b=h.tobe[a];h.create(a,function(c,d){for(var e=0,f=b.length;e<f;e++)b[e](c);h.done.push(a);delete h.tobe[a]})}h.tobeorder.length||(h.lock=!1)},load:function(a,b){a=g.trim(a);var c=g.parseObj({cbk:function(){},isAsync:!1,
isClear:!1,sudo:!1},b),d=c.cbk;h.tobe.hasOwnProperty(a)?d&&h.tobe[a].push(d):-1==g.indexOf(a,h.done)||c.sudo?(h.conf[a]={isAsync:c.isAsync,isClear:c.isClear},h.tobe[a]=[],d&&h.tobe[a].push(d),h.tobeorder.push(a)):d&&d(a);h.lock||h.start()}},t=function(){var a={},b={};this.push=function(c,d,e){var f="";if(d.constructor==m)f=d.mName||g.unikey();else if("string"==typeof d)f=d;else throw"MSG pushing error!";d="__MSG__"+f;c={data:c,sender:e.mName,receiver:f};if(e=(b[d]||[]).length)for(f=0;f<e;f++){var h=
b[d][f];h&&h(c)}else return a[d]?a[d].push(c):a[d]=[c],d};this.get=function(c){var d="";if(c.constructor==m)d=c.mName;else if("string"==typeof c)d=c;else throw"MSG getting error!";if(d)return c="__MSG__"+d,d=a[c],a[c]=[],d&&d.length?d:void 0};this.addHandler=function(a,d){var e="";if(a.constructor==m)e=a.mName;else if("string"==typeof a)e=a;else throw"MSG adding handler error!";e&&(e="__MSG__"+e,b[e]?b[e].push(d):b[e]=[d])};this.delHandler=function(a,d){var e="";if(a.constructor==m)e=a.mName;else if("string"==
typeof a)e=a;else throw"MSG deleting handler error!";if(e){var e="__MSG__"+e,f=0;if(b[e]&&(f=b[e].length))if(d)for(var g=0;g<f;g++)b[e][g]==d&&b[e].splice(g,0,1);else b[e]=[]}}},r=new t,n={cbks:{},list:{},done:[],defined:{},tobestart:{},start:function(a,b){var c=this;c.cbks[a]||(c.cbks[a]=[]);var d=a;a=f.getModule(a);var e=a.rLink;if(0==e.length||-1!=g.indexOf(a.mName,c.done))b&&b(a.mName);else{c.cbks[d].push(b);for(var k=e.length,l=k,m=0;m<k;m++){var n=e[m];if(-1!=g.indexOf(n,c.done)){if(l--,0>=
l){c.done.push(a.mName);for(var p=c.cbks[d];p&&p.length;){var r=p.shift();r&&r()}}}else(function(){var b=n,e=a,f=function(){c.start(b,function(){l--;if(0>=l){c.done.push(e.mName);for(var a=c.cbks[d];a&&a.length;){var b=a.shift();b&&b()}}})};c.defined[b]?f():h.load(c.list[b],{cbk:function(){c.defined[b]?f():(c.tobestart[b]||(c.tobestart[b]=[]),c.tobestart[b].push(f))},isAsync:!0,isClear:!0})})()}}}},u=function(){var a={};this.get=function(b){if("string"==typeof b&&a.hasOwnProperty(b))return a[b]};
this.set=function(){var b=[];if(g.isWhat(arguments[0],"object")){var c=arguments[0],d=arguments[1],e;for(e in c)!c.hasOwnProperty(e)||!d&&a.hasOwnProperty(e)?b.push(e):a[e]=c[e]}else"string"==typeof arguments[0]&&1<arguments.length&&(c=arguments[0],e=arguments[1],(d=arguments[2])||!a.hasOwnProperty(c)?a[c]=e:b.push(c));k.debug&&b.length&&g.consoleLog("Setting path error list: "+b.join(","))}},s=new u,m=function(a){var b={};this.skipRecord=function(a,d){a&&(b[a]=!!d)};this.needSkip=function(a){var d=
!1;b.hasOwnProperty(a)&&(d=b[a]);return d};this.mName=a;this.rLink=[];this.leftLinkNum=0;this.logList=[];this["interface"]={};this.__tailState=k.debug||!1;this.mUsable=!0};m.prototype.tailLog=function(a){k.useLog&&("undefined"==typeof a&&(a=!0),a&&!this.__tailState&&a&&this.showLog(this.__tailState),this.__tailState=a)};m.prototype.log=function(a,b){if(k.useLog){var c=g.getTime(),c="LOG["+(b||"normal")+"]:"+a+" At "+c+"\n";this.__tailState&&("process"===this.__tailState&&g.consoleLog(c),b===this.__tailState&&
g.consoleLog(c));this.logList[this.logList.length]=c}};m.prototype.showLog=function(a){if(!k.useLog)return"";if("string"==typeof a)for(var b="",c=0,d=this.logList.length;c<d;c++){var e=this.logList[c],f=e.indexOf("]"),h=e.indexOf("[");e.slice(h+1,f)==a&&(b+=e)}else b=this.logList.join("");g.consoleLog(b);return b};m.prototype.build=function(){if(this.mUsable){var a={},b;switch(typeof arguments[0]){case "function":var c=arguments[0]();a[k.initFnName]=c;break;case "object":a=arguments[0];b=arguments[1];
"string"==typeof arguments[2]&&(arguments[0].hasOwnProperty(arguments[2])?a[arguments[2]]=arguments[0][arguments[2]]:a={});break;case "string":a[arguments[0]]=arguments[1];b=arguments[2];break;default:this.log('Illegal param for "building"',"Error");return}for(var d in a)if(a.hasOwnProperty(d)){if(this.hasOwnProperty(d))if(b)this.log('Repeat define for "'+d+'"',"Warning");else{this.log('Repeat define for "'+d+'"',"Error");continue}this[d]="function"==typeof a[d]?a.constructor!=m?function(){"process"!=
this.__tailState||this.needSkip(d)||this.log("Running:"+(this.mName||"anonymity")+k.splitSym+d,"Record");return a[d].apply(this,arguments)}:a[d]:a[d];this.log('Success define for "'+d+'" in '+this.mName,"Define")}return this}this.log('No permission for "building"!',"Error")};m.prototype.mSend=function(a,b){try{r.push(a,b,this),this.log("Sending data from "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error sending from "+this.mName||"anonymity","Error")}};m.prototype.mMonitor=function(a,
b){try{r.addHandler(b||this,a),this.log("Adding monitor in "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error monitor in "+this.mName||"anonymity","Error")}};m.prototype.mUnmonitor=function(a,b){try{r.delHandler(b||this,a),this.log("Deleting monitor in "+this.mName||"anonymity success!","Success")}catch(c){this.log("Error unmonitor in "+this.mName||"anonymity","Error")}};m.prototype.interfaceDefine=function(a,b,c){if(2>arguments.length)this.log("Param illegal for Interface defining",
"Error");else{if(this["interface"].hasOwnProperty(a))if(c)this.log('Repeat interface defining for "'+a+'"',"Warning");else{this.log('Repeat interface defining for "'+a+'"',"Error");return}"string"==typeof b&&(b=[b]);var d=[],e;for(e in b)"string"!=typeof b[e]?this.log("Illegal interface methods name for defining!","Error"):d.push(b[e]);this["interface"][a]=d;this.log('Success defining for interface "'+a+'"',"Success");return d}};m.prototype.interfaceCheck=function(a){var b=[];if("string"==typeof a){if(!this["interface"].hasOwnProperty(a))return this.log('The interface name of "'+
a+'" is not exist!',"Failure"),!1;b=this["interface"][a]}else if(g.isWhat(a,"array"))b=a;else return this.log("Illegal params for interface checking!","Error"),!1;a=b.length;for(var c=[],d=0;d<a;d++)b[d]in this||c.push(b[d]);return c.length?c:!1};m.prototype.require=function(a,b){var c=b;a=g.trim(a);if("string"!=typeof b||!g.trim(b))var c=f.path.get(a),d=s.get(a),c="string"==typeof c?c:d,c="string"==typeof c?c:a+".js";c=k.sourceRoot+g.trim(c);s.set(a,c);!n.list.hasOwnProperty(a)&&(n.list[a]=c);-1==
g.indexOf(a,this.rLink)&&this.rLink.push(a)};m.prototype.create=function(){var a;arguments.length&&(a=Array.prototype.slice.call(arguments,0));f.create(this.mName,a)};m.prototype.tools=f.tools=new l;f.modules={};f.mods={};f.path=new u;f.defineModule=function(a){a=g.trim(a);var b=new m(a);if(-1===a.indexOf(k.splitSym)){if(a in f.modules)throw"Repeat define module for "+a;f.modules[a]=b}else{for(var c=a.split(k.splitSym),d=f.modules,e=0,h=c.length-1;e<h;e++)d=d[c[e]]=c[e]in d?d[c[e]]:{};d[c.pop()]=
b}n.defined[a]=!0;g.delay(function(){for(var b=n.tobestart[a];b&&b.length;)b.shift()()});return b};f.define=function(a,b){var c=f.defineModule(a);c.build(function(){return b(c,f.tools,f.mods,f.modules)});return c};f.create=function(a,b,c){if(a=g.trim(a)){var d=f.getModule(a);if(!d)throw"The module("+a+') you input to "create" is not exist!';n.start(a,function(){g.isArray(b)||(b=[b]);var e=d[k.initFnName],e="function"===typeof e?e.apply(d,b):e;d[k.handlerName]=e;g.nameSpace(a,f.mods,e);c&&c(d)})}};
f.destroy=function(a){return a&&f.modules[a]?(f.modules[a][k.destroyFnName]&&f.modules[a][k.destroyFnName](),delete f.modules[a],n.defined[a]&&delete n.defined[a],!0):!1};f.reload=function(a){if(a&&f.modules[a]){var b=f.path.get(a),c=s.get(a),b="string"==typeof b?b:c;if(!b)return!1;f.destroy(a);h.load(b,{sudo:!0,isClear:!0});return!0}return!1};f.options=function(){var a={};switch(arguments.length){case 2:a[arguments[0]]=arguments[1];break;case 1:a=arguments[0];break;default:return!1}k=g.parseObj(k,
a);return!0};f.pubsub=function(){var a=new t,b={mName:"$pub"},c="__pub_channel_"+g.unikey(4)+"_";return{publish:function(d,e){if(0<d.length&&10>=d.length)return a.push(e,c+d,b),!0},subscribe:function(b,e){if(0<b.length&&10>=b.length)return a.addHandler(c+b,e),!0},unsub:function(b,e){if(0<b.length&&10>=b.length)return a.delHandler(c+b,e),!0}}}();f.newM=function(a){return new m(a)};f.jsLoader=h.load;f.getModule=function(a){return g.nameToItem(a,f.modules)};f.getMod=function(a){return g.nameToItem(a,
f.mods)};f.use=function(a){return(a=f.getModule(a))&&a[k.handlerName]};f.expandT=function(a,b,c){var d=[];if(g.isWhat(a,"object")){c=b;for(var e in a)!f.tools.hasOwnProperty(e)||c?f.tools[e]=a[e]:d.push(e)}else!f.tools.hasOwnProperty(a)||c?f.tools[a]=b:d.push(a);k.debug&&d.length&&g.consoleLog("Expanding tools error list: "+d.join(","))};(function(){for(var a,b,c,d=document.getElementsByTagName("script"),e=0,f=d.length;e<f;e++)a=d[e],(b=a.getAttribute(k.scriptSrc))&&(c=a.getAttribute(k.afterSrc))&&
h.load(b,{cbk:function(){h.load(c,{isClear:!0})},isClear:!0})})();"object"===typeof window.module&&window.module&&"object"===typeof window.module.exports?window.module.exports=f:(window.$M=f,"function"===typeof define&&define.amd&&define("bmodulejs",[],function(){return f}))}}();