!function(){var $M={},$T={},$C={};$M.info='VERSION: 2.0.5 \n AUTHOR: liuping \n A Controller For Modules';$C={'initFnName':'init','destroyFnName':'destroy','autoLoad':true,'autoSrc':true,'scriptSrc':'msrc','afterSrc':'after','handlerName':'me','codePackage':false,'sourceRoot':'','debug':false,'useLog':true};var _tools=function(){};_tools.prototype.unikey=function(len){var l=(typeof len=='number')?len:16;var result='';for(;result.length<l;result+=Math.random().toString(36).substr(2));return result.substr(0,l)};_tools.prototype.trim=function(str){if((typeof str).toLowerCase()!='string'){return str}var sL=str.length;var reg=/\s/;for(var i=0;i<sL;i++){if(!reg.test(str.charAt(i))){break}}if(i>=sL){return''}for(var j=sL-1;j>=0;j--){if(!reg.test(str.charAt(j))){j++;break}}return str.slice(i,j)};_tools.prototype.isArray=function(arr){return Object.prototype.toString.call(arr)==='[object Array]'};_tools.prototype.isWhat=function(v,type){var typeV=(typeof v);if(typeV=='undefined'){return/^undefined$/i.test(type)}else{var reg=new RegExp(type,'gi');try{var transStr=v.constructor.toString();return reg.test(transStr)}catch(NULL){return(/^object$/i.test(typeV)&&/^null$/i.test(type))}}};_tools.prototype.parseObj=function(rootObj,newObj,isNumParse){var tempObj={};newObj=this.isWhat(newObj,'object')?newObj:{};for(var i in rootObj){tempObj[i]=rootObj[i];if(i in newObj){var temp=newObj[i];var parseVal=parseFloat(temp);if(isNumParse&&!isNaN(parseVal)){temp=parseVal}tempObj[i]=temp}}return tempObj};_tools.prototype.isNode=function(node,TypeVal){if(node&&((typeof node.nodeType).toLowerCase()=='number')){if(!TypeVal){return true}else{return node.nodeType==parseInt(TypeVal)}}else{return false}};_tools.prototype.objLength=function(obj){var l=0;for(var i in obj){if(obj.hasOwnProperty(i)){l++}}return l};_tools.prototype.getTime=function(linkStr,offsetDay){var linkStr=linkStr||'/';var d=new Date();var offD=parseInt(offsetDay);if(!isNaN(offD)){var dayS=86400000*offD;d=new Date((+d)+dayS)}var mon=(d.getMonth()+1),day=d.getDate(),minu=d.getMinutes(),hour=d.getHours(),seco=d.getSeconds(),year=d.getFullYear();mon=mon.toString().length<2?('0'+mon):mon;day=day.toString().length<2?('0'+day):day;hour=hour.toString().length<2?('0'+hour):hour;minu=minu.toString().length<2?('0'+minu):minu;seco=seco.toString().length<2?('0'+seco):seco;var dayArr=[];dayArr.push(year);dayArr.push(mon);dayArr.push(day);var hourArr=[];hourArr.push(hour);hourArr.push(minu);hourArr.push(seco);return dayArr.join(linkStr)+' '+hourArr.join(':')};_tools.prototype.extend=function(subClass,supClass){var F=function(){};F.prototype=supClass.prototype;subClass.prototype=new F();subClass.prototype.constructor=subClass;return subClass};_tools.prototype.newClass=function(obj,nclass){var nClass=nclass||function(){};if(typeof obj=='object'){for(var i in obj){if(obj.hasOwnProperty(i)){nClass.prototype[i]=obj[i]}}}return nClass};_tools.prototype.indexOf=function(item,arr){if(!this.isArray(arr)){return false}if(typeof arr.indexOf!='undefined'){$T.indexOf=function(otherItem,otherArr){return otherArr.indexOf(otherItem)}}else{$T.indexOf=function(otherItem,otherArr){var index=-1;for(var i=0;i<otherArr.length;i++){if(otherArr[i]===otherItem){index=i;break}}return index}}return $T.indexOf(item,arr)};_tools.prototype.consoleLog=function(str){if(console&&console.log){console.log(str)}};_tools.prototype.emptyFn=function(){};_tools.prototype.removeNode=function(theNode){theNode.parentNode.removeChild(theNode)};_tools.prototype.isDefined=function(nameStr,obj){nameStr=this.trim(nameStr);var mod;if(nameStr.indexOf('.')==-1){mod=obj[nameStr]}else{var nameArr=nameStr.split('.');var tempFunc=obj;for(var i=0;i<nameArr.length;i++){tempFunc=tempFunc[nameArr[i]];if(typeof tempFunc=='undefined'){break}}mod=tempFunc}return!!mod};$T=new _tools;$T.delay=function(fn){setTimeout(function(){fn&&fn()})};var _dom={};_dom.c=document.createElement;_dom.body=document.body;_dom.addAttrs=function(n,attr){for(var i in attr){if(attr.hasOwnProperty(i)){n.setAttribute(i,attr[i])}}};var _js={'lock':false,'tobe':{},'tobeorder':[],'conf':{},'done':[],'onload':function(sNode,cbk,srcStr){if('onload'in sNode){_js.onload=function(sNodeo,cbko,src){sNodeo.onload=function(){var tempThis=this;cbko&&cbko(tempThis,sNodeo);_js.conf[src]&&_js.conf[src].isClear&&$T.removeNode(sNodeo)}}}else if('onreadystatechange'in sNode){_js.onload=function(sNodeo,cbko,src){sNodeo.onreadystatechange=function(){var tempThis=this;var rs=tempThis.readyState;if(rs=='loaded'||rs=='complete'){cbko&&cbko(tempThis,sNodeo);_js.conf[src]&&_js.conf[src].isClear&&$T.removeNode(sNodeo)}}}}else{return false}return _js.onload(sNode,cbk,srcStr)},'create':function(srcStr,cbk){var realSrc=srcStr;var sNode=document.createElement('script');var attrs={'type':'text/javascript','src':realSrc};if(_js.conf[srcStr]&&_js.conf[srcStr].isAsync){attrs['async']='true';attrs['defer']=''}_dom.addAttrs(sNode,attrs);_js.onload(sNode,cbk,srcStr);_dom.body.appendChild(sNode)},'start':function(){_js.lock=true;while(_js.tobeorder.length){var src=_js.tobeorder.shift();var cbks=_js.tobe[src];_js.create(src,function(_this,sNodeo){for(var i=0,cL=cbks.length;i<cL;i++){cbks[i](_this)}_js.done.push(src);delete _js.tobe[src]})}if(!_js.tobeorder.length){_js.lock=false}},'load':function(srcStr,conf){srcStr=$T.trim(srcStr);var config=$T.parseObj({'cbk':function(){},'isAsync':false,'isClear':false,'sudo':false},conf);var cbk=config.cbk;if(_js.tobe.hasOwnProperty(srcStr)){cbk&&_js.tobe[srcStr].push(cbk)}else if($T.indexOf(srcStr,_js.done)!=-1&&!config.sudo){cbk&&cbk(srcStr)}else{_js.conf[srcStr]={'isAsync':config.isAsync,'isClear':config.isClear};_js.tobe[srcStr]=[];cbk&&_js.tobe[srcStr].push(cbk);_js.tobeorder.push(srcStr)}if(!_js.lock){_js.start()}}};var _msg=function(){var $msgpool={};var $handler={};this.push=function(data,mReceiver,mSender){var mName='';if(mReceiver.constructor==M){mName=mReceiver.mName||$T.unikey()}else if(typeof mReceiver=='string'){mName=mReceiver}else{throw'MSG pushing error!';}var receiverIndex='__MSG__'+mName;var sender=mSender.mName;var dataPkg={'data':data,'sender':sender,'receiver':mName};var hL=($handler[receiverIndex]||[]).length;if(hL){for(var i=0;i<hL;i++){var hFn=$handler[receiverIndex][i];hFn&&hFn(dataPkg)}}else{$msgpool[receiverIndex]?$msgpool[receiverIndex].push(dataPkg):($msgpool[receiverIndex]=[dataPkg]);return receiverIndex}};this.get=function(mReceiver){var mName='';if(mReceiver.constructor==M){mName=mReceiver.mName}else if(typeof mReceiver=='string'){mName=mReceiver}else{throw'MSG getting error!';}if(mName){var receiverIndex='__MSG__'+mName;var data=$msgpool[receiverIndex];$msgpool[receiverIndex]=[];return data&&data.length?data:undefined}};this.addHandler=function(mReceiver,fn){var mName='';if(mReceiver.constructor==M){mName=mReceiver.mName}else if(typeof mReceiver=='string'){mName=mReceiver}else{throw'MSG adding handler error!';}if(mName){var receiverIndex='__MSG__'+mName;$handler[receiverIndex]?$handler[receiverIndex].push(fn):($handler[receiverIndex]=[fn])}};this.delHandler=function(mReceiver,fn){var mName='';if(mReceiver.constructor==M){mName=mReceiver.mName}else if(typeof mReceiver=='string'){mName=mReceiver}else{throw'MSG deleting handler error!';}if(mName){var receiverIndex='__MSG__'+mName,hL=0;if($handler[receiverIndex]&&(hL=$handler[receiverIndex].length)){if(fn){for(var i=0;i<hL;i++){if($handler[receiverIndex][i]==fn){$handler[receiverIndex].splice(i,0,1)}}}else{$handler[receiverIndex]=[]}}}}};var mMsg=new _msg;var _rely={'cbks':{},'list':{},'done':[],'defined':{},'tobestart':{},'start':function(module,cbk){var self=this;if(!self.cbks[module]){self.cbks[module]=[]}var strM=module;module=$M.getModule(module);var rLink=module.rLink;if(rLink.length==0||$T.indexOf(module.mName,self.done)!=-1){cbk&&cbk(module.mName)}else{self.cbks[strM].push(cbk);var rL=rLink.length;var count=rL;for(var i=0;i<rL;i++){var tempMName=rLink[i];if($T.indexOf(tempMName,self.done)!=-1){count--;if(count<=0){self.done.push(module.mName);var cbks=self.cbks[strM];while(cbks&&cbks.length){var cb=cbks.shift();cb&&cb()}}}else{(function(){var theMName=tempMName;var theStrM=strM;var theM=module;var tempFn=function(){self.start(theMName,function(){count--;if(count<=0){self.done.push(theM.mName);var cbks=self.cbks[theStrM];while(cbks&&cbks.length){var cb=cbks.shift();cb&&cb()}}})};_js.load(self.list[theMName],{'cbk':function(){if(self.defined[theMName]){tempFn()}else{if(!self.tobestart[theMName]){self.tobestart[theMName]=[]}self.tobestart[theMName].push(tempFn)}},'isAsync':true,'isClear':true})})()}}}}};var _path=function(){var path={};this.get=function(name){if(typeof name=='string'&&path.hasOwnProperty(name)){return path[name]}};this.set=function(){var failList=[];if($T.isWhat(arguments[0],'object')){var paths=arguments[0],sudo=arguments[1];for(var i in paths){if(paths.hasOwnProperty(i)&&(sudo||!path.hasOwnProperty(i))){path[i]=paths[i]}else{failList.push(i)}}}else if(typeof arguments[0]=='string'&&arguments.length>1){var name=arguments[0],url=arguments[1],sudo=arguments[2];if(sudo||!path.hasOwnProperty(name)){path[name]=url}else{failList.push(name)}}$C.debug&&failList.length&&$T.consoleLog('Setting path error list: '+failList.join(','))}};var $mPath=new _path;var M=function(name){var skipRecordList={};this.skipRecord=function(name,state){if(!name){return}skipRecordList[name]=!!state};this.needSkip=function(name){var state=false;if(skipRecordList.hasOwnProperty(name)){state=skipRecordList[name]}return state};this.mName=name;this.rLink=[];this.leftLinkNum=0;this.logList=[];this.interface={};this.__tailState=$C.debug||false;this.mUsable=true};var $handler={};M.prototype.tailLog=function(state){if(!$C.useLog)return;if(typeof state=='undefined'){state=true}if(state&&!this.__tailState){state&&this.showLog(this.__tailState)}this.__tailState=state};M.prototype.log=function(str,type){if(!$C.useLog)return;var timeStr=$T.getTime('-');var logStr='LOG['+(type||'normal')+']:'+str+' At '+timeStr+'\n';if(this.__tailState){this.__tailState===true&&$T.consoleLog(logStr);if(type===this.__tailState){$T.consoleLog(logStr)}}this.logList[this.logList.length]=logStr};M.prototype.showLog=function(type){if(!$C.useLog)return'';if(typeof type=="string"){var staticLog='';for(var i=0,logL=this.logList.length;i<logL;i++){var item=this.logList[i];var pose=item.indexOf(']'),poss=item.indexOf('[');if(item.slice(poss+1,pose)==type){staticLog+=item}}}else{var staticLog=this.logList.join('')}$T.consoleLog(staticLog);return staticLog};M.prototype.build=function(){if(!this.mUsable){this.log('No permission for \"building\"!','Error');return}var paramObj={},sudo;switch(typeof arguments[0]){case'object':paramObj=arguments[0];sudo=arguments[1];if(typeof arguments[2]=='string'){if(arguments[0].hasOwnProperty(arguments[2])){paramObj[arguments[2]]=arguments[0][arguments[2]]}else{paramObj={}}}break;case'string':paramObj[arguments[0]]=arguments[1];sudo=arguments[2];break;default:this.log('Illegal param for \"building\"','Error');return}for(var i in paramObj){if(!paramObj.hasOwnProperty(i)){continue}if(this.hasOwnProperty(i)){if(sudo){this.log('Repeat define for \"'+i+'\"','Warning')}else{this.log('Repeat define for \"'+i+'\"','Error');continue}}if(typeof paramObj[i]=='function'){if(paramObj.constructor!=M){this[i]=function(){if(this.__tailState=='process'&&!this.needSkip(i)){this.log('Running:'+(this.mName||'anonymity')+'.'+i,'Record')}return paramObj[i].apply(this,arguments)}}else{this[i]=paramObj[i]}}else{this[i]=paramObj[i]}this.log('Success define for \"'+i+'\" in '+this.mName,'Define')}return this};M.prototype.mSend=function(data,receiver){try{mMsg.push(data,receiver,this)this.log('Sending data from '+this.mName||'anonymity success!','Success')}catch(e){this.log('Error sending from '+this.mName||'anonymity','Error')}};M.prototype.mMonitor=function(fn,mName){try{mMsg.addHandler(mName||this,fn);this.log('Adding monitor in '+this.mName||'anonymity success!','Success')}catch(e){this.log('Error monitor in '+this.mName||'anonymity','Error')}};M.prototype.mUnmonitor=function(fn,mName){try{mMsg.delHandler(mName||this,fn);this.log('Deleting monitor in '+this.mName||'anonymity success!','Success')}catch(e){this.log('Error unmonitor in '+this.mName||'anonymity','Error')}};M.prototype.interfaceDefine=function(name,methods,sudo){if(arguments.length<2){this.log('Param illegal for Interface defining','Error');return}if(this.interface.hasOwnProperty(name)){if(sudo){this.log('Repeat interface defining for \"'+name+'\"','Warning')}else{this.log('Repeat interface defining for \"'+name+'\"','Error');return}}if(typeof methods=='string'){methods=[methods]}var result=[];for(var i in methods){if(typeof methods[i]!='string'){this.log('Illegal interface methods name for defining!','Error');continue}result.push(methods[i])}this.interface[name]=result;this.log('Success defining for interface \"'+name+'\"','Success');return result};M.prototype.interfaceCheck=function(iName){var methods=[];if(typeof iName=='string'){if(!this.interface.hasOwnProperty(iName)){this.log('The interface name of \"'+iName+'\" is not exist!','Failure');return false}methods=this.interface[iName]}else if($T.isWhat(iName,'array')){methods=iName}else{this.log('Illegal params for interface checking!','Error');return false}var mL=methods.length;var notSupported=[];for(var i=0;i<mL;i++){if(methods[i]in this){continue}notSupported.push(methods[i])}return(notSupported.length?notSupported:false)};M.prototype.require=function(nameStr,srcUrl){var srcStr=srcUrl;nameStr=$T.trim(nameStr);if(typeof srcUrl!='string'||!$T.trim(srcUrl)){srcStr=nameStr.replace(/\./g,'\/')+'.js'}srcStr=$C.sourceRoot+$T.trim(srcStr);$mPath.set(nameStr,srcStr);!_rely.list.hasOwnProperty(nameStr)&&(_rely.list[nameStr]=srcStr);$T.indexOf(nameStr,this.rLink)==-1&&(this.rLink.push(nameStr))};M.prototype.create=function(){var spec;if(arguments.length){spec=Array.prototype.slice.call(arguments,0)}$M.create(this.mName,spec)};M.prototype.tools=$M.tools=new _tools;$M.modules={};$M.define=function(mNameStr){mNameStr=$T.trim(mNameStr);var mExample=new M(mNameStr);if(mNameStr.indexOf('.')==-1){if(mNameStr in $M.modules){throw'Repeat define for '+mNameStr;}$M.modules[mNameStr]=mExample}else{var nameArr=mNameStr.split('.');var tempFunc=$M.modules;for(var i=0;i<nameArr.length-1;i++){tempFunc=tempFunc[nameArr[i]]=(nameArr[i]in tempFunc)?tempFunc[nameArr[i]]:{}}tempFunc[nameArr.pop()]=mExample}_rely.defined[mNameStr]=true;$T.delay(function(){var fns=_rely.tobestart[mNameStr];while(fns&&fns.length){var fn=fns.shift();fn()}});return mExample};$M.create=function(nameStr,spec,cbk){nameStr=$T.trim(nameStr);if(!nameStr){return}var mod=$M.getModule(nameStr);if(!mod){throw'The module('+nameStr+') you input to "create" is not exist!';}var cbkFn=function(){if(!$T.isArray(spec)){spec=[spec]}mod[$C.handlerName]=(mod[$C.initFnName]&&mod[$C.initFnName].apply(mod,spec));cbk&&cbk(mod)};_rely.start(nameStr,cbkFn)};$M.destroy=function(nameStr){if(nameStr&&$M.modules[nameStr]){$M.modules[nameStr][$C.destroyFnName]&&$M.modules[nameStr][$C.destroyFnName]();delete $M.modules[nameStr];_rely.defined[nameStr]&&(delete _rely.defined[nameStr]);return true}else{return false}};$M.reload=function(nameStr){if(nameStr&&$M.modules[nameStr]){var path=$mPath.get(nameStr);if(!path){return false}$M.destroy(nameStr);_js.load(path,{'sudo':true,'isClear':true});return true}else{return false}};$M.options=function(){var specObj={};switch(arguments.length){case 2:specObj[arguments[0]]=arguments[1];break;case 1:specObj=arguments[0];break;default:return false}$C=$T.parseObj($C,specObj);return true};$M.newM=function(name){return new M(name)};$M.jsLoader=_js.load;$M.getModule=function(moduleName){var nameStr=$T.trim(moduleName);if(!nameStr.length){return false}var mod;if(nameStr.indexOf('.')==-1){mod=$M.modules[nameStr]}else{var nameArr=nameStr.split('.');var tempFunc=$M.modules;for(var j=0;j<nameArr.length;j++){tempFunc=tempFunc[nameArr[j]];if(typeof tempFunc=='undefined'){break}}mod=tempFunc}return mod};$M.expandT=function(){var errorList=[];if($T.isWhat(arguments[0],'object')){var fns=arguments[0],sudo=arguments[1];for(var i in fns){if(!$M.tools.hasOwnProperty(i)||sudo){$M.tools[i]=fns[i]}else{errorList.push(i)}}}else{var name=arguments[0],fn=arguments[1],sudo=arguments[2];if(!$M.tools.hasOwnProperty(name)||sudo){$M.tools[name]=fn}else{errorList.push(name)}}$C.debug&&errorList.length&&$T.consoleLog('Expanding tools error list: '+errorList.join(','))};var $pluginInit=function(){var item,srcVal,afterVal,scripts=document.getElementsByTagName('script');for(var i=0,sL=scripts.length;i<sL;i++){item=scripts[i];if((srcVal=item.getAttribute($C.scriptSrc))&&(afterVal=item.getAttribute($C.afterSrc))){_js.load(srcVal,{'cbk':function(){_js.load(afterVal,{'isClear':true})},'isClear':true})}}};var $init=function(){$pluginInit()};$init();window.$M=$M}();